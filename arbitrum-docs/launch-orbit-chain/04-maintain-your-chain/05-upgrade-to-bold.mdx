---
title: 'How to upgrade to BoLD'
description: 'How to upgrade an Orbit chain to BoLD'
author: jose-franco
sme: jose-franco
content_type: how-to
---

This how-to provides step-by-step instructions for Orbit chain operators who want to enable BoLD on their chain. Familiarity with Nitro, [BoLD](/how-arbitrum-works/bold/gentle-introduction.mdx), and [chain ownership](/launch-orbit-chain/04-maintain-your-chain/03-ownership-structure-access-control.mdx) is expected.

::::info This is not an ArbOS upgrade

Enabling BoLD in your chain involves updating the Nitro contracts of your chain and making sure that your nodes are running the expected minimum (or higher) version.

However, enabling BoLD does not require upgrading your ArbOS version.

::::

## Overview

To enable BoLD in your Orbit chain, you'll have to perform these actions:

1. Make sure your nodes are running at least [Nitro v3.5.1](https://github.com/OffchainLabs/nitro/releases/tag/v3.5.1) and enable the required parameters
2. Upgrade your Nitro contracts to [v3.0.0](https://github.com/OffchainLabs/nitro-contracts/releases/tag/v3.0.0)

Let's dive into it.

## 1. Upgrade your nodes to Nitro v3.5.1 or higher

Before updating the contracts, you want to make sure your nodes are ready for the update. Nitro v3.5.1 introduced compatibility with both pre-BoLD and BoLD chains, to ensure a smooth upgrade. Nodes will automatically detect whether the chain is running pre-BoLD Rollup and Challenge contracts, or BoLD ones, and will perform the appropriate calls depending on that check.

Most of the parameters used in Nitro before v3.5.1 will stay the same when running a higher version but, depending on the type of node, you'll have to include a few more BoLD-specific parameters:

- For validator nodes: add `--node.bold.enable=true` and `--node.bold.strategy=<MakeNodes | ResolveNodes | Defensive>` to configure the validator to create and/or confirm assertions in the new Rollup contract (find more information in [How to run a validator](/run-arbitrum-node/more-types/02-run-validator-node.mdx#step-1-configure-and-run-your-validator))
- For all other types of node: add `--node.bold.enable=true` to enable [watchtower mode](/run-arbitrum-node/03-run-full-node.mdx#watchtower-mode)

## 2. Upgrade your Nitro contracts to v3.0.0

This section explains how to perform the upgrade of your chain contracts to v3.0.0. Note that this process expects that your chain uses the canonical contracts. If your chain uses customized contracts, you might need to use a different updating script/contract than the one available.

During the upgrade operation, the following actions will be performed:

1. Upgrade the Bridge, Inbox, RollupEventInbox, Outbox and SequencerInbox contracts to v3.0.0
2. Deploy the new v3.0.0 BoLD ChallengeManager
3. Migrate the v2 Rollup contract into a new v3.0.0 Rollup contract address
4. Setup the Rollup contract according to the new configuration and use the latest confirmed assertion on the old rollup as genesis of the new rollup

### Step 0: Pre-requisites

To effectively upgrade your Nitro contracts using the provided upgrade action, your contracts must be in one these versions:

- Inbox: v1.1.0 - v2.1.0 inclusive
- Outbox: any
- SequencerInbox: v1.2.1 - v2.1.0 inclusive
- Bridge
  - eth chain: v1.1.0 - v2.1.0 inclusive
  - custom-fee token chain: v2.0.0 - v2.1.0 inclusive
- RollupProxy: v1.1.0 - v2.1.0 inclusive
- RollupAdminLogic: v2.0.0 - v2.1.0 inclusive
- RollupUserLogic: v2.0.0 - v2.1.0 inclusive
- ChallengeManager: v2.0.0 - v2.1.0 inclusive

To determine the exact version used by your contracts, [follow these instructions](https://github.com/OffchainLabs/orbit-actions#check-version-and-upgrade-path).

Note that some of the contracts will not be updated and that it's normal to have some contracts still in the old version after the upgrade, since their code is equivalent to the new version.

### Step 1: Clone the nitro-contracts repository and build the contracts

We'll be using a `BOLDUpgradeAction.sol` contract available in the nitro-contracts repository to perform the upgrade operation.

So let's first clone the nitro-contracts repository and checkout the appropriate tag:

```shell
$ git clone https://github.com/OffchainLabs/nitro-contracts.git
$ cd nitro-contracts
$ git checkout v3.0.0
```

Once in the right version, let's install the dependencies and build the contracts

```shell
$ yarn install
$ yarn build:all
```

### Step 2: Configure your chain parameters

The action contract that performs the upgrade will need to be parametrized with the information of your chain. To set this configuration, create a new file `scripts/files/configs/custom.ts` with the following contents:

```typescript
import { parseEther } from 'ethers/lib/utils';
import { Config } from '../../boldUpgradeCommon';
import { hoursToBlocks } from './utils';

export const arb1: Config = {
  contracts: {
    excessStakeReceiver: '0xAddress',
    rollup: '0xAddress',
    bridge: '0xAddress',
    sequencerInbox: '0xAddress',
    rollupEventInbox: '0xAddress',
    outbox: '0xAddress',
    inbox: '0xAddress',
    upgradeExecutor: '0xAddress',
  },
  proxyAdmins: {
    outbox: '0xAddress',
    inbox: '0xAddress',
    bridge: '0xAddress',
    rei: '0xAddress',
    seqInbox: '0xAddress',
  },
  settings: {
    challengeGracePeriodBlocks: hoursToBlocks(48),
    confirmPeriodBlocks: 45818, // ~6.4 days
    challengePeriodBlocks: 45818, // ~6.4 days
    stakeToken: '0xAddress',
    stakeAmt: parseEther('1'),
    miniStakeAmounts: [parseEther('0'), parseEther('1'), parseEther('1')],
    chainId: YourChainId,
    minimumAssertionPeriod: 75,
    validatorAfkBlocks: 201600,
    disableValidatorWhitelist: false,
    blockLeafSize: 2 ** 26,
    bigStepLeafSize: 2 ** 19,
    smallStepLeafSize: 2 ** 23,
    numBigStepLevel: 1,
    maxDataSize: 117964,
    isDelayBufferable: true,
    bufferConfig: {
      max: hoursToBlocks(48), // 2 days
      threshold: hoursToBlocks(1), // well above typical posting frequency
      replenishRateInBasis: 500, // 5% replenishment rate
    },
  },
  validators: ['0xAddress', '0xAddress', '0xAddress'],
};
```

Adjust the configuration to match that of your chain. Pay close attention to every parameter since it will override the existing configuration of your chain. Note the following:

- `contracts.excessStakeReceiver` should be an address that will receive both the excess stakes of the Rollup contract, and the loser stakes.
- Note that in the first `contracts` property you need to specify the contracts addresses, while the next `proxyAdmins` property expects the addresses of the ProxyAdmin of those contracts (they all generally use the same ProxyAdmin contract).
- Make sure `disableValidatorWhitelist` is set to `false` unless you're absolutely sure you want to allow for permissionless validation.
- Adjust `maxDataSize` to match that of your chain (you can call `Inbox.maxDataSize()` to get the right value)
- Set `chainId` to the id of your chain.
- Adjust `stakeAmt` and `miniStakeAmounts` to the desired amounts.

### Step 3: Prepare and deploy the upgrade contract

We'll now prepare the upgrade contract with the parameters we just set, and we'll deploy it in the parent chain of our chain.

First create a `.env` file based on the `.env-sample` file.

```shell
$ cp .env-sample .env
```

Make sure you update the `CONFIG_NETWORK_NAME` env variable to match the filename of the configuration file you created in the previous step.

```shell
CONFIG_NETWORK_NAME=custom
```

Now you can run the `prepare` script, which will deploy the action contract with the specified configuration parameters. Note that:

- you can use any account to deploy the contract, so `L1_PRIV_KEY` does not necessarily need to be the chain owner.
- `L1_RPC_URL` should point to an RPC of your parent chain.

```shell
$ L1_PRIV_KEY=xxx L1_RPC_URL=xxx yarn script:bold-prepare
...
Deployed contracts written to: scripts/files/sepoliaDeployedContracts.json
Done.
```

Optionally, the script can try to verify the deployed contracts by adding the following parameters:

- set `DISABLE_VERIFICATION` to `false`.
- use the right key for verifying the contracts on the block explorer depending on your parent chain: `ETHERSCAN_API_KEY | ARBISCAN_API_KEY | NOVA_ARBISCAN_API_KEY | BASESCAN_API_KEY`.
- set the `network` flag to your parent chain.

```shell
$ L1_PRIV_KEY=xxx L1_RPC_URL=xxx DISABLE_VERIFICATION=false ARBISCAN_API_KEY=xxx yarn script:bold-prepare --network {mainnet|arb1|nova|base|sepolia|arbSepolia}
```

### Step 4: Gather the information of the current state of the chain

We now gather the information of the current state of the chain (the last confirmed assertion) so we can initialize the new Rollup contract with that confirmed assertion.

To prevent validators from confirming new assertions, it is recommended to temporarily stop all validator nodes at this point.

Note that:

- you can use any account to deploy the contract, so `L1_PRIV_KEY` does not necessarily need to be the chain owner.
- `L1_RPC_URL` should point to an RPC of your parent chain.

```shell
$ L1_PRIV_KEY=xxx L1_RPC_URL=xxx yarn script:bold-populate-lookup
...
Done.
```

### Step 5: Run the upgrade script

We are now ready to perform the upgrade. The following script will either perform the upgrade directly or print the upgrade payload depending on the private key used:

- If `L1_PRIV_KEY` is the chain owner, the script will perform the upgrade directly. Note that it will not ask for confirmation before sending the transaction.
- If `L1_PRIV_KEY` is NOT the chain owner, the script will print the upgrade payload.

::::warning

The following script will send the upgrade transaction directly if the `L1_PRIV_KEY` specified is the private key of the chain owner.

::::

```shell
$ L1_PRIV_KEY=xxx L1_RPC_URL=xxx yarn script:bold-local-execute
upgrade executor: 0x5FEe78FE9AD96c1d8557C6D6BB22Eb5A61eeD315
execute(...) call to upgrade executor: 0x1cff79cd000000000000000000000000f8199ca3702c09c78b957d4d820311125753c6d2000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a4ebe03a93000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000030000000000000000000000008a8f0a24d7e58a76fc8f77bb68c7c902b91e182e00000000000000000000000087630025e63a30ecf9ca9d580d9d95922fea6af0000000000000000000000000c32b93e581db6ebc50c08ce381143a259b92f1ed00000000000000000000000000000000000000000000000000000000
```

### Step 6: Monitor the validation process

Once the upgrade is executed, monitor that assertions are created and confirmed in the new Rollup contract. Note that the new events emitted are `AssertionCreated` and `AssertionConfirmed`.

If you stopped all validators in Step 4, make sure you start them again so they can continue creating assertions.

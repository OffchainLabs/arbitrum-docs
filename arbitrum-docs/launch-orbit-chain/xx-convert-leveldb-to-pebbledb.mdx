---
title: "Convert `leveldb` to `pebble`"
description: "Convert the current `leveldb` to a `pebble` database."
author: pete-vielhaber
sme: 
---

<!-- 
	Why is this conversion important? 
    And/or why would someone want to make this change
-->

## `convert-databases.bash` script
The `convert-databases.bash` script converts Nitro databases from `leveldb` to `pebble`. Internally, it uses the [`dbconv` tool](#dbconv-tool).

<!-- link to location -->
The script is located in the Nitro Docker image.

```bash
Usage: convert-databases.bash [OPTIONS..]

OPTIONS:
--dbconv          dbconv binary path (default: "/usr/local/bin/dbconv")
--src             directory containing source databases (default: "/home/user/.arbitrum/arb1/nitro")
--dst             destination directory
--force           remove destination directory if it exists
--skip-existing   skip convertion of databases which directories already exist in the destination directory
--clean           sets what should be removed in case of error, possible values:
                      "failed" - remove database which conversion failed (default)
                      "none"   - remove nothing, leave unfinished and potentially corrupted databases
                      "all"    - remove whole destination directory
```

Upon successful completion the script prints out:

```bash
== Conversion status:
   l2chaindata database: converted
   l2chaindata database freezer (ancient): copied
   arbitrumdata database: converted
   wasm database: converted
   classic-msg database: converted
```

### Running conversion script in Docker
```bash
docker run \
       --detach \
       --rm \
       --name convert_db \
       -v /path/to/src/data/arbitrum:/home/user/.arbitrum \
       -v /path/to/dst/data/arbitrum:/home/user/dst \
       -it \
       --entrypoint /bin/bash \
       nitro-node \
       -c "convert-databases.bash --dst /home/user/dst/arb1/nitro"
```

## `dbconv` tool 
`dbconv` tool can be used to:
- Convert single database: Copy all entries from a single source database to a destination database that may use a different database engine (`leveldb` or `pebble`).
- Compact single database: Run compaction on the destination database.
- Verify database contents: Check if all keys (and optionally values) from the source database are present in the destination database.

Selected command arguments:
```bash
--dst.data string         directory of stored chain state
--dst.db-engine string    backing database implementation to use ('leveldb' or 'pebble') (default "pebble")
--src.data string         directory of stored chain state
--src.db-engine string    backing database implementation to use ('leveldb' or 'pebble') (default "leveldb")
--convert                 enables conversion step
--compact                 enables compaction step
--verify string           enables verification step ("" = disabled, "keys" = only keys, "full" = keys and values)
```

To see all possible configuration options run: `dbconv --help`

### Example usage
- Converting a `leveldb` database to a `pebble` and compacitng the resulting database.
```bash
./target/bin/dbconv --src.data /path/to/source/database/ --src.db-engine leveldb --dst.data /path/to/destination/database/ --dst.db-engine "pebble" --convert --compact
```

- Verifying that all source database entries are in the destination database (checking only if keys exist).
```bash
./target/bin/dbconv --src.data /path/to/source/database/ --src.db-engine leveldb --dst.data /path/to/destination/database/ --dst.db-engine "pebble" --verify "keys"
```

- Converting a `leveldb` database to a `pebble`, compacting the resulting database and then verifying that all keys from the source database exist in the destination database.
```bash
./target/bin/dbconv --src.data /path/to/source/database/ --src.db-engine leveldb --dst.data /path/to/destination/database/ --dst.db-engine "pebble" --convert --compact --verify "keys"
```

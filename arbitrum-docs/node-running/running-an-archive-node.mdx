---
title: 'How to run an archive node'
description: Learn how to run an Arbitrum archive node on your local machine.
author: jason-wanxt
content-type: how-to
---

An Arbitrum **archive node** is a full node that maintains an archive of historical chain states. This how-to walks you through the process of configuring an archive node on your local machine so that you can query both pre-Nitro and post-Nitro state data.

Note that **most users won't need to configure an archive node**. This type of node is great for a small number of use-cases - for example, if you need to process historical data.

### Before we begin

Before the Nitro upgrade happened, Arbitrum One was running on the Classic stack for about one year (before block height 2207817). Although the Nitro chain uses the latest snapshot of the Classic chain's state as its genesis state (see [state migration](../migration/state-migration.mdx)), **the Nitro stack can't serve archive requests for pre-Nitro blocks**.

Running an Arbitrum One **full node** in **archive mode** lets you access both pre-Nitro and post-Nitro blocks, but it requires you to run **both Classic and Nitro nodes** together. You may not need to do this, depending on your use case:

| Use case                                                                         | Required node type(s)                                     | Docs                                                                        |
| -------------------------------------------------------------------------------- | --------------------------------------------------------- | --------------------------------------------------------------------------- |
| Access the **Arbitrum network** without running your own node                    | Fully managed by third-parties, exposed via RPC endpoints | [Node Providers](./node-providers.mdx)                                      |
| Run an **archive node** for **Nitro Goerli Rollup Testnet** or **Arbitrum Nova** | Full node (Nitro)                                         | [How to run a full node (Nitro)](./running-a-node.md)                       |
| Send **post-Nitro** archive requests                                             | Full node (Nitro)                                         | [How to run a full node (Nitro)](./running-a-node.md)                       |
| Send **pre-Nitro** archive requests                                              | Full node (Classic)                                       | [How to run a full node (Classic, pre-Nitro)](./running-a-classic-node.mdx) |
| Send **post-Nitro** _and_ **pre-Nitro** archive requests                         | Full node (Nitro) _and_ full node (Classic)               | That's what this how-to is for; you're in the right place.                  |

### System requirements

:::caution

The minimum storage requirements will change over time as the Nitro chain grows at a rate of approximately 128GB per week (Arbitrum One chain). We recommend exceeding the minimum requirements as much as you can to minimize risk and maintenance overhead.

:::

1. **RAM:** 16GB+ for Nitro and 32GB+ for Classic
2. **CPU:** 4+ core CPU
3. **Storage:** Minimum 2TB SSD (make sure it is extendable)
4. **Docker images:** We'll specify these in the below commands; you don't need to manually download them.
   - Latest Docker image for **Arbitrum One**: `offchainlabs/nitro-node:v2.0.13-174496c`
   - Latest Docker image for **Arbitrum Classic**: `offchainlabs/arb-node:v1.4.5-e97c1a4`
5. **Database snapshots:**
   - Arbitrum One Nitro genesis database snapshot
     - Use the parameter `--init.url="https://snapshot.arbitrum.io/mainnet/nitro.tar"` on first startup to initialize the Nitro database
     - SHA256 checksum: `a609773c6103435b8a04d32c63f42bb5fa0dc8fc38a2acee4d2ab2d05880205c`
     - Size: 33.5573504 GB
   - Arbitrum One Classic database snapshot
     - Download the latest Arbitrum One Classic database snapshot `"https://snapshot.arbitrum.io/mainnet/db.tar"` and put it to the mounted point directory.

Note that other chains don't have Classic blocks, and thus don't require an initial genesis database.

### Review and configure ports

<!-- todo: explain why these ports are important and what action needs to be taken - do rules need to be configured? -->
<!-- todo: format into a table  -->

- RPC: `8547`
- Sequencer Feed: `9642`
- WebSocket: `8548`

### Review and configure parameters

| Parameter                                   | Description                                                                                                                                     |
| ------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------- |
| `--l1.url=<Layer 1 Ethereum RPC URL>`       | Provide an standard L1 node RPC endpoint that you run yourself or from a third-party node provider (see [Node Providers](./node-providers.mdx)) |
| `--l2.chain-id=<L2 Chain ID>`               | See [public chains](../public-chains.mdx) for a list of Arbitrum chains and the respective L2 chain IDs                                         |
| `--node.caching.archive`                    | Required for running an **Arbitrum One** archival node and retains past block state                                                             |
| `--node.cache.allow-slow-lookup`            | Required for running an **Arbitrum Classic** archival node. When this option is present, will load old blocks from disk if not in memory cache. |
| `--core.checkpoint-gas-frequency=156250000` | Required for running an **Arbitrum Classic** archival node.                                                                                     |

### Run the Docker image(s)

<!-- this is the procedure part, so we can focus on steps to take, and move "conceptual information" into a dedicated concept doc -->
<!-- Arbitrum One has been upgraded to Nitro, the latest Arbitrum tech stack; "Arbitrum Classic" is our term for the old, pre-Nitro tech stack. The Nitro node databases have the raw data of all blocks, including pre-Nitro blocks. However, Nitro nodes cannot execute anything on pre-Nitro blocks. Arbitrum Nova started as a Nitro chain, so has no classic blocks. -->

When running a Docker image, an external volume should be mounted to persist the database across restarts. The mount point should be `/home/user/.arbitrum/mainnet`.

<!-- todo: does the user need to do anything to configure the mount point, or is this handled by the below docker commands? -->

To run both Arbitrum One and Arbitrum Classic in archive mode, follow one of the below examples:

- **Arbitrum One archive node**: <!-- todo: when should I choose the first one over the second one? what do they do differently? -->
  ```shell
  docker run --rm -it -v /some/local/dir/arbitrum:/home/user/.arbitrum -p 0.0.0.0:8547:8547 -p 0.0.0.0:8548:8548 offchainlabs/nitro-node:v2.0.13-174496c --l1.url https://l1-node:8545 --l2.chain-id= --http.api=net,web3,eth,debug --http.corsdomain=* --http.addr=0.0.0.0 --http.vhosts=* --node.caching.archive
  ```
- **Arbitrum One archive node**:
  ```shell
  docker run --rm -it -v /some/local/dir/arbitrum:/home/user/.arbitrum -p 0.0.0.0:8547:8547 -p 0.0.0.0:8548:8548 offchainlabs/nitro-node:v2.0.11-8e786ec --l1.url https://l1-node:8545 --l2.chain-id=42161 --node.rpc.classic-redirect=<classic node RPC> --http.api=net,web3,eth,debug --http.corsdomain=* --http.addr=0.0.0.0 --http.vhosts=* --node.caching.archive
  ```
- **Arbitrum Classic archive node**:
  ```shell
  docker run --rm -it -v /some/local/dir/arbitrum-mainnet/:/home/user/.arbitrum/mainnet -p 0.0.0.0:8547:8547 -p 0.0.0.0:8548:8548 offchainlabs/arb-node:v1.4.5-e97c1a4 --l1.url=https://l1-node:8545/ --node.chain-id=42161 --l2.disable-upstream --node.cache.allow-slow-lookup --core.checkpoint-gas-frequency=156250000
  ```

Note that the above commands both map to port `8547` on their hosts. If you want to run both on the same host, you should edit those mapping to different ports, and specify your Classic node RPC url as `<classic node RPC>` in your Nitro start command. To verify the connection health of your node(s), see [Docker network between containers - Docker Networking Example](https://www.middlewareinventory.com/blog/docker-network-example/).

#### A note on permissions

The Docker image is configured to run as non-root `UID 1000`. If you're running in Linux and you're getting permission errors when trying to run the Docker image, run this command to allow all users to update the persistent folders, replacing `arbitrum-mainnet` as needed:

```shell
mkdir /some/local/dir/arbitrum-mainnet
chmod -fR 777 /some/local/dir/arbitrum-mainnet
```

<!-- todo: FAQ -->

### Troubleshooting

If you run into any issues, visit the [Node-running Troubleshooting guide](./troubleshooting-running-nodes).

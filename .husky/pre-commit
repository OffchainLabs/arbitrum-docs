#!/usr/bin/env sh

cd website

# Check if globalVars.js has staged changes
if git diff --cached --name-only | grep -q "src/resources/globalVars.js"; then
  echo "ðŸ”„ Updating variable references..."
  yarn update_variable_refs

  echo "ðŸ”„ globalVars.js changed, running precompiles reference table generator..."
  yarn generate_precompiles_ref_tables

  echo "ðŸ’… running formatter"
  yarn format
fi

# Check for missing redirects
yarn ts-node scripts/check-redirects.ts
CHECK_REDIRECTS_EXIT_CODE=$?

if [ $CHECK_REDIRECTS_EXIT_CODE -ne 0 ]; then
  exit 1
fi

echo "\nâœ… Pre-commit tasks completed\nðŸ’¡ Note: To bypass hooks, use git commit --no-verify"